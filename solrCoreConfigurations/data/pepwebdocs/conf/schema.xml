<?xml version="1.0" encoding="UTF-8" ?>
<!--
    PEP Web Database Schema for core PEPWebDocs

    2021-04-13 Added new counting fields useful for QA keyboarding and hopefully more

    2020-12-08 Changed art_graphic_list to indexed, so client can find an instance by a graphic id contained within.

    2020-11-17 Added art_iss_seqnbr for journals like FA which really work by number more than issue.  See FA.014A.0001A 
               for an example.

    2020-10-02 Added schema fields for sort issue with Solr.  Solr doesn't properly sort fields
               that are tokenized for full-text search.  So added string_lc, which uses a solr.KeywordTokenizerFactory
               tokenizer (as described on the internet), which actually works better than a plain string
               field because it sorts mixed case properly (ignoring case).  But I populate these fields
               with the data having punctuation removed, instead of using copy fields, because I also remove
               all punctuation, which otherwise negatively affects the sort.
               
               (This mod note added in the 10-03 update, but the push before this on 10-02 had the schema changes.)

    2020-09-24 Many simple fields changed to non-stored, non-indexed, but docvalues       
               As tested/confirmed with this element in Solr 8.6, Solr Schema elements (at least strings and integers) 
               that are docvalues don't need to be indexed or saved to be returnable in results and be searchable

                Side Note: tested adding a field (art_product_key) this to an existing core via interactive schema and 
                 it still allowed stat updates on my localhost

    2020-09-22  Added figure_count, table_count and art_graphic_list (callouts)

    2020-09-04  Moving art_cited_x updates to post-load updates.  to do that, like the art_views, no
                data should be indexed during the original load, or you get a Solr error that says 
                you can't update data records that have child records.  Solr makes it hard to change
                from one that was initially loaded to one that is updated, but the trick seems to be
                delete the old field, then use docvalues as the only characteristic of the re-added 
                field.  It may be then that you can reinstate other things such as indexed.  But
                for now, I'm going to completely rebuild using just stored and docvalues, which 
                should be enough anyway for a pint field.
                
                (Reversed order of update text so most recent on top)

    2020-08-30  Set up field for text search of just body in case we need to back away
                from the level 2 para search model.  This is the old
                art_body_xml, but now just body_xml to match the other named sections like
                notes_xml
                
                Added para_art_id to see if we can use that to work around level 2 search
                syntax/semantics limitations; if searching by para, that way, you could get the parents
                without depending on Solr's child model at least in the server.
                
                Added meta_marked_corrections to load cgrp and potentially other individual errors
                
    2020-08-14: Fixed bib fields (in this core) for search or faceting only; they don't show up in return results, but you can see values in schema
                analysis or facets.
                
                Fixed loader to normalize these for faceting: removed punctuation and set to lower case.
    2020-08-13: Add art_excerpt_xml, since art_excerpt is in HTML and computed at load time.  This way the client app can do their
                own XSLT by requesting XML version.

    2020-08-04: Changed the way offsite documents are handled; schema value art_offsite controls whether text can be returned,
                 otherwise, it's like other documents.

    2020-07-06: Added bk fields to show when a book is a subdoc (not the maintoc) e.g., to bring back SE/GW mainTOCs, search
                  for "bk_subdoc:false && art_sourcecode:SE || GW"
                  
                  Also art_info_xml (contains bk_ data too) so all metadata note
                    part of the HTML is visible too (when returning HTML)
                    
                  Also added para_lgrid for SE/GW mapping.

    2020-05-30: Added definitions for art_views_last... fields.  Now supports in place updates to 
                  allow these to be updated weekly or monthly.

    2019-05-16: had to change art_kwds to multiValued, in testing against
                full PEP Data set.

    2020-04-25: Added: for faceting:
                          art_kwds_str - string_ci
                          glossary_terms- string_ci
                          glossary_group_terms - string_ci
                          freuds_italics - string_ci

    2020-04-11: Added:
                  strings type, boolean, booleans because it was required online going to Solr 8.5
                  (cores would not load without that.)

    2020-04-10: Added:
                  Added art_authors_citations to allow sort by authors
                  docValues for quotes_spkr set to true
                  docValue whereever it was supported

    2020-01-20: Re-add summaries_xml used to display summaries when there's no abstract

    2020-01-05: More schema clean up. 
                 
    2019-12-19: Schema clean up. 
                Removing unnecessary items, many can be grabbed from the full-text XML
                noted removals:
                  art_body_xml
             
    2019-12-18: Added storeOffsetsWithPositions to true in text_general.  This should speed up highlighting in long text fields.
                (now removed...caused an error with pysolr)
                
    2019-11-15: artvoltitle was at top but never used/loaded.  These are important for TOCs.
                Renamed to art_vol_title and setting up
                the load program to use it.  Document example: AIM.049.0001A

    2019-11-12: Added additional author fields (data auto copied from old field)
                to test (and deal with) partial search.  Trying ngrm field 
                definition from medium: https://medium.com/aubergine-solutions/partial-string-search-in-apache-solr-4b9200e8e6bb
    2019-07-*:  Added art_body_xml, to allow search to easily exclude abstract, summaries, and references (as our current full article search does!)          
            
    2019-06-*:  Tuning:
                Added text_xml_offsite, so we can search but not store offsite text and there's no danger of returning it

   Schema version attribute note: 
   
   The default values for each property depend on the underlying FieldType class, which in turn may depend on the version 
   attribute of the <schema/>. Keep version to standard values.

-->
<!-- Schema name just for labeling, the managed-schema file name is what Solr looks for -->
<schema name="pepwebdocs" version="1.61">
  <uniqueKey>id</uniqueKey>
  <!-- Document ID (Locator) -->
  <field name="id" type="string" indexed="true" stored="true"/>

  <!--Field _root_ Required to use nesting-->
  <field name="_root_" type="string" indexed="true" stored="false" docValues="false" />

  <field name="file_size" type="pint" indexed="true" stored="true"/>
  <field name="file_last_modified" type="pdate" indexed="true" stored="true"/>
  <field name="file_name" type="string" indexed="true" stored="true"/>
  <field name="timestamp" type="pdate" indexed="true" stored="true" multiValued="false"/>

  <!-- Copy of article title (see copy below) -->
  <field name="format" type="string" indexed="true" stored="true"/>
  <!-- Version is required for atomic updates -->
  <field name="_version_" type="plong" indexed="false" stored="false" docValues="true"/>

  <!-- ************************************************************************************************* -->
  <!-- Key display fields and their index surrogates (not displayed) -->
  <!-- ************************************************************************************************* -->
  <field name="art_id" type="string" indexed="true" stored="true" multiValued="false"/>
  <!-- this will be a full-text reference to the citing document, it can be used to list matching document info -->
  <field name="art_citeas_xml" type="string" indexed="true" stored="true" multiValued="false" docValues="true"/>
  <!--......................................................................................................-->
  <!--FULL TEXT-->
  <!-- text_xml searches-->
  <!-- field text also includes other text objects, like text_xml_offsite -->
  <field name="text_xml" type="text_simple" indexed="true" stored="true" multiValued="false"/> # set to multivalued false
  <!-- use this for search...-->
  <field name="art_info_xml" type="string" indexed="false" stored="true" multiValued="false" docValues="false"/> <!--2020-08-30 load this as doc minus refs -->
  <field name="text" type="text_simple" indexed="true" stored="false" multiValued="false"/>
  <field name="text_syn" type="text_general_syn" indexed="true" stored="false" multiValued="false"/>
  <!--If offsite text, then the server shall return a pointer to the data, rather than the full-text.  But it will be searchable. -->
  <field name="art_offsite" type="boolean" indexed="true" stored="true" docValues="true" multiValued="false"/>
  <copyField source="text_xml*" dest="text"/>
  <copyField source="text_xml*" dest="text_syn"/>
  <!--......................................................................................................-->
  <!--TITLE-->
  <!-- Title includes subtitle -->
  <field name="title" type="text_simple" indexed="true" stored="true" multiValued="false"/> # changed to multivalued false (no reason its multivalued)
  <field name="title_syn" type="text_general_syn" indexed="true" stored="false" multiValued="false"/>
  <field name="title_str" type="string_lc" indexed="true" uninvertible="true" stored="false" multiValued="false"/> # for sorting
  <field name="art_title" type="text_simple" indexed="true" stored="true" multiValued="false"/> # added back in for naming consistency
  <field name="art_title_syn" type="text_general_syn" indexed="true" stored="false" multiValued="false"/> # added back in for naming consistency
  <field name="art_title_str" type="string_lc" indexed="true" uninvertible="true" stored="false" multiValued="false"/>  # for sorting
  <copyField source="title" dest="title_syn"/>
  <copyField source="title" dest="art_title"/>
  <copyField source="title" dest="art_title_syn"/>
  <!--<copyField source="title" dest="art_title_str"/>-->
  <!--<copyField source="title" dest="title_str"/> -->
  <field name="art_title_xml" type="text_simple" indexed="true" stored="true" multiValued="false"/>
  <field name="art_subtitle_xml" type="text_simple" indexed="true" stored="true" multiValued="false"/>
  <!--......................................................................................................-->
  <!--DOCUMENT METADATA-->
  <field name="art_vol" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_vol_int" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_vol_suffix" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_vol_title" type="text_simple" indexed="true" stored="true" multiValued="false"/>
  <field name="art_vol_title_str" type="string_lc" indexed="true" uninvertible="true" stored="false" multiValued="false"/> # for sorting
  <!--<copyField source="art_vol_title" dest="art_vol_title_str"/> -->
  <field name="art_iss" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_iss_title" type="string_ci" indexed="true" stored="true" multiValued="false"/>
  <field name="art_iss_title_str" type="string_lc" indexed="true" uninvertible="true" stored="false" multiValued="false"/>  # for sorting
  <!--Added 2020-11-17 for certain journals that we keep number for like FA-->
  <field name="art_iss_seqnbr" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <!--<copyField source="art_iss_title" dest="art_iss_title_str"/> -->
  <field name="art_year" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_year_int" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_origrx" type="string" indexed="true" stored="true" multiValued="false"/>
  <!--Added art_views_lastcalyear 2020-05 to meet search requirements-->
  <!--These have to be false for all but docValues to allow in place updates-->
  <field name="art_cited_all" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_cited_5" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_cited_10" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_cited_20" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
  <!--Added art_views_lastcalyear 2020-05 to meet search requirements-->
  <!--These have to be false for all but docValues to allow in place updates-->
  <field name="art_views_lastcalyear" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
  <field name="art_views_last1mos" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
  <field name="art_views_last6mos" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
  <field name="art_views_last12mos" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
  <field name="art_views_lastweek" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
   
  <field name="art_sourcecode" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_sourcetitleabbr" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_sourcetitlefull" type="text_simple" indexed="true" stored="true" multiValued="false"/>
  <field name="art_sourcetitlefull_str" type="string_lc" indexed="true" uninvertible="true" stored="false" multiValued="false"/>  # for sorting
  <!--<copyField source="art_sourcetitlefull" dest="art_sourcetitlefull_str"/> -->
  
  <!--<field name="art_sourcetitle_fulltext" type="text_simple" indexed="true" stored="true" multiValued="false"/>-->
  <!--<copyField source="art_sourcetitlefull" dest="art_sourcetitle_fulltext"/>-->
  <field name="art_doi" type="string" indexed="true" stored="true" multiValued="false"/>
  <!--name for this section of an issue, e.g., section name in a issue TOC-->
  <field name="art_newsecnm" type="text_simple" indexed="true" stored="true" multiValued="false"/>
  <!-- extra metadata for books -->
  <field name="bk_title_xml" type="text_simple" indexed="true" stored="true" multiValued="false"/>
  <field name="bk_title_str" type="string_lc" indexed="true" uninvertible="true" stored="false" multiValued="false"/>  # for sorting
  <!--<copyField source="bk_title_xml" dest="bk_title_str"/>-->
  <field name="bk_alsoknownas_xml"  type="text_simple" indexed="true" stored="true" multiValued="false"/>
  <field name="bk_editors_xml" type="text_simple" indexed="true" stored="true" multiValued="true"/>
  <field name="bk_seriestitle_xml" type="text_simple" indexed="true" stored="true" multiValued="false"/>
  <field name="bk_seriestitle_str" type="string_lc" indexed="true" uninvertible="true" stored="false" multiValued="false"/>  # for sorting
  <copyField source="bk_seriestitle_xml" dest="bk_seriestitle_str"/>
  <!--<field name="bk_pubyear" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>-->
  <!--Added 7/6 for SE/GW and to cover general book info (e.g., next/prev id)details which do not come back in the html-->
  <field name="bk_subdoc" type="boolean" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <!--New fields for book management 2020-08-11 -->
  <!--Books with a TOC (main book in series or single book) point to themselves; others point to where the TOC is.-->
  <field name="bk_main_toc_id" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="bk_series_toc_id" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <!--This is in the schema because it can be used to sort a multiple instance book by sequence-->
  <field name="bk_next_id" type="string" indexed="false" stored="false" multiValued="false" docValues="true" sortMissingFirst="true"/>
  
  <!-- ************************************************************************************************* -->
  <!-- End Key display fields! -->
  <!-- ************************************************************************************************* -->


  <!-- sections, can be used to grab part of a book, etc. Never really used so far-->
  <!-- <field name="sections_xml" type="text_simple" indexed="true" stored="true" multiValued="true"/>-->
  <!-- The text field is the default search zone when a field is not supplied.  So despite the waste, let's index everything here. -->


  <!-- Metadata fields -->
  <!-- Store whether its PEPArchive, PEPCurrent, etc. -->
  <field name="file_classification" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>

  <!-- Article authors -->
  <!-- So how can we do queries for partial last names...can't bunch authors in printable form.  
       Try two fields, one XML one presentation one multifield. -->
  <!--Set docValues true to allow faceting authors -->
  <field name="authors" type="string" indexed="true" stored="true" multiValued="true" docValues="true" />
  <field name="art_authors" type="string_ci" indexed="true" stored="true" multiValued="true"/>
  <field name="art_authors_mast" type="string_ci" indexed="true" stored="true" multiValued="false"/>
  
  <!--Added 20201019 to compare the masts with ids and see if they are complete, and the same (this field 
      was apparently here in an early incarnation but has been removed)
      art_authors_ids_str compare to art_authors_mast, though the former is from the attribute author_id
      -->
  <field name="art_authors_ids" type="string_ci" indexed="true" stored="true" multiValued="true"/>
  <field name="art_authors_ids_str"  type="string_ci" indexed="true" stored="true" multiValued="false"/>
  
  <!--Added 20200410 to allow sort by authors-->
  <field name="art_authors_citation" type="text_simple" indexed="true" stored="true" multiValued="false"/>
  <field name="art_authors_citation_str" type="string_lc" indexed="true" uninvertible="true" stored="false" multiValued="false"/>  # for sorting
  <copyField source="art_authors_citation" dest="art_authors_citation_str"/> # for sorting
  <!--try to improve author search for single names and full names-->
  <!--Many of these are Temporary. fpr trying different search results.  #TODO-->
  <field name="art_authors_text" type="text_simple" indexed="true" stored="false" multiValued="true"/>
  <field name="art_authors_ngrm" type="text_ngrm" indexed="true" stored="false" multiValued="true"/>
  <field name="art_authors_mast_text" type="text_simple" indexed="true" stored="false" multiValued="false"/>
  <field name="art_authors_mast_ngrm" type="text_ngrm" indexed="true" stored="false" multiValued="true"/>
  <field name="art_authors_unlisted" type="string_ci" indexed="true" stored="true" multiValued="true"/>
  <field name="art_authors_xml" type="text_simple" indexed="true" stored="true" multiValued="true"/>
  <!--Added 7/21 to facilitate smartsearch-->
  <field name="art_authors_lastnames" type="string_ci" indexed="true" stored="false" multiValued="true"/>
  
  <copyField source="art_authors" dest="art_authors_text"/>
  <copyField source="art_authors" dest="art_authors_ngrm"/>
  <copyField source="art_authors_mast" dest="art_authors_mast_text"/>
  <copyField source="art_authors_mast" dest="art_authors_mast_ngrm"/>

  <!-- by paras-->
  <!--<field name="art_body_xml" type="text_simple" indexed="true" stored="false" multiValued="false"/>-->
  <!-- deprecate this, no longer loaded-->
  <!--<field name="abstracts_xml" type="text_general" indexed="true" stored="true" multiValued="true"/> -->
  <!--This is better, use single xml field.-->
  <!--Do we really need to index these?  Seems likely not.  Review and #TODO later 2020-08-30 -->
  <field name="abstract_xml" type="text_general" indexed="true" stored="true" multiValued="false"/> <!--this is used to display-->
  <!--Need to reintroduce this!  Accidentally removed from Alpha2-->
  <field name="summaries_xml" type="text_general" indexed="true" stored="true" multiValued="true"/> <!--this is used to display-->
  <!--Precompute an extract for docs without abstracts or summaries.  Will be html -->
  <field name="art_excerpt" type="text_general" indexed="true" stored="true" multiValued="false" uninvertible="false"/> <!--this is used to display-->
  <!--Store XML version of displayab;e summary/abstract so the client can do their own XSLT transform. 2020-08-13 -->
  <field name="art_excerpt_xml" type="text_general" indexed="true" stored="true" multiValued="false" uninvertible="false"/> <!--this is used to display-->

  <!-- Added this 6/25 to allow any part of a journal name to be searched.-->
  <!-- journal, book, or video -->
  <field name="art_sourcetype" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_type" type="string" indexed="false" stored="false" multiValued="false" docValues="true" />
  <field name="art_pgrg" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <!--Added 2020-05-06-->
  <field name="art_lang" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/> <!--changed to multivalued=false, 2020-06-17 (it's an attribute of artinfo)-->
  <field name="art_issn" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <!--Added 2020-05-06-->
  <field name="art_isbn" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="art_kwds"  type="text_simple" indexed="true" stored="true" multiValued="false"/>
  <field name="art_qual" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <!--Added for faceting use, 2020-04-25-->
  <!--For faceting multi word keywords, may want to eventually just replace art_kwds with this -->
  <field name="art_kwds_str"  type="string_ci" indexed="true" stored="false" multiValued="true"/>
  
  <!-- author data -->
  <field name="author_aff_xml" type="text_general" indexed="true" stored="true" multiValued="true"/>
  <field name="author_bio_xml" type="text_general" indexed="true" stored="true" multiValued="true"/>
  <!-- This next line doesn't work! Load via python -->
  <!-- <copyfield source="author_name_str" dest="authors"/> -->

  <!-- Biblio fields -->
  <!-- added docValues for faceting (also need to load in document database)-->
  <field name="bib_authors" type="string" indexed="true" uninvertible="true" stored="false" multiValued="true" docValues="false"/> 
  <field name="bib_rx" type="string" indexed="true" uninvertible="true" stored="false" multiValued="true" docValues="false"/> 
  <field name="bib_title" type="string" indexed="true" uninvertible="true" stored="false" multiValued="true" docValues="false"/> 
  <field name="bib_journaltitle" type="string" indexed="true" uninvertible="true" stored="false" multiValued="true" docValues="false"/> 
  <field name="references_xml" type="text_general" indexed="true" stored="false" multiValued="true"/>

  <field name="caption_text_xml" type="text_general" indexed="true" stored="true" multiValued="true"/>
  <field name="caption_title_xml" type="text_general" indexed="true" stored="true" multiValued="true"/>

  <!-- *********************** Counting fields *********************** -->
  <field name="art_pgcount" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>
  <field name="reference_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 

  <!--Added 2021-04-13 Mainly for checking XML data -->
  <field name="art_abs_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
  <field name="art_kwds_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
  <field name="art_ftns_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
  <field name="art_paras_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
  <field name="art_terms_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>  
  <field name="art_quotes_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
  <field name="art_dreams_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>  
  <field name="art_dialogs_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>  
  <field name="art_notes_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>  
  <field name="art_poems_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>  
  <field name="art_citations_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>  
  <field name="art_headings_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>   
  <field name="art_chars_count" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/>  <!-- may not populate -->

  <!--Added 2020-09-22-->
  <field name="art_graphic_list" type="string_ci" indexed="true" stored="true" multiValued="true" docValues="false"/>
  <field name="art_figcount" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 
  <field name="art_tblcount" type="pint" indexed="false" stored="false" multiValued="false" docValues="true"/> 

  <!--Added 7/24 to facilitate smartsearch-->
  <field name="art_authors_count" type="pint" indexed="false" stored="false" docValues="true" multiValued="false"/>

  <!-- 2020-09-23
       added art_product_key, a non-unique code that Opas can send to the auth server to verify access 
       at a product (grouped) level. If product grouping changes, for example, if SE were being 
       authorized by book/volume the loader program would need to change to reflect that.  
       Alternatively, this could be done by the AuthServer if the rules, now in the loader, were put there.
       Not sure whether we'll use this but for now, it's in the Schema for testing.
  -->
  <field name="art_product_key" type="string" indexed="false" stored="false" multiValued="false" docValues="true"/>
  
  <field name="headings_xml" type="text_simple" indexed="true" stored="false" multiValued="true"/>
  <!-- Revision info for document; #TODO change to string perhaps and remove indexing -->
  <field name="meta_xml" type="text_simple" indexed="true" stored="true"/>
  <!--cgrp_era2 are pep corrections.  Added 2020-08-30 -->
  <field name="meta_marked_corrections"  type="text_general" indexed="true" stored="true" multiValued="true"/>

  <field name="tagline" type="string_ci" indexed="true" stored="true" multiValued="true"/>
  <field name="quotes_spkr"  type="string_ci" indexed="true" stored="true" multiValued="true"/> 

  <!-- use this to search body without reference section (reference section above separately for search)-->
  <field name="body_xml" type="text_general" indexed="true" stored="false" multiValued="false"/> 
  <field name="body_xml_syn" type="text_general_syn" indexed="true" stored="false" multiValued="false"/> 
  <copyField source="body_xml" dest="body_xml_syn"/>
  
  <!--#TODO: reinstate these-->
  <field name="quotes_xml" type="text_general" indexed="true" stored="false" multiValued="true"/>
  <field name="quotes_xml_syn" type="text_general_syn" indexed="true" stored="false" multiValued="true"/>
  <field name="dialogs_xml" type="text_general" indexed="true" stored="false" multiValued="true"/>
  <field name="dialogs_xml_syn" type="text_general_syn" indexed="true" stored="false" multiValued="true"/>
  <field name="notes_xml" type="text_general" indexed="true" stored="false" multiValued="true"/>
  <field name="notes_xml_syn" type="text_general_syn" indexed="true" stored="false" multiValued="true"/>
  <field name="panels_xml" type="text_general" indexed="true" stored="false" multiValued="true"/>
  <field name="panels_xml_syn" type="text_general_syn" indexed="true" stored="false" multiValued="true"/>
  <field name="dreams_xml" type="text_general" indexed="true" stored="false" multiValued="true"/>
  <field name="dreams_xml_syn" type="text_general_syn" indexed="true" stored="false" multiValued="true"/>
  <field name="poems_xml" type="text_general" indexed="true" stored="false" multiValued="true"/>
  <field name="poems_xml_syn" type="text_general_syn" indexed="true" stored="false" multiValued="true"/>
  <copyField source="quotes_xml" dest="quotes_xml_syn"/>
  <copyField source="dialogs_xml" dest="dialogs_xml_syn"/>
  <copyField source="notes_xml" dest="notes_xml_syn"/>
  <copyField source="panels_xml" dest="panels_xml_syn"/>
  <copyField source="dreams_xml" dest="dreams_xml_syn"/>
  <copyField source="poems_xml" dest="poems_xml_syn"/>
  <copyField source="quotes_xml" dest="quotes_xml_syn"/>

  <!--New fields 6/10/2020-->
  <field name="tables_xml" type="text_general" indexed="true" stored="false" multiValued="true"/>

  <!--Added for faceting use, 2020-04-25 Storage not required -->
  <field name="glossary_terms" type="string_ci" indexed="true" stored="false" multiValued="true"/>
  <field name="glossary_group_terms" type="string_ci" indexed="true" stored="false" multiValued="true"/>
  <!--Store for debug only-->
  <field name="freuds_italics" type="string_ci" indexed="true" stored="false" multiValued="true"/>
  
  <!--These are not displayed directly.  Search only. -->
  <!-- Special term fields -->
  
  <!-- terms_xml may not be needed in the long-term, only good for search -->
  <field name="terms_xml" type="text_simple" indexed="true" stored="false" multiValued="true"/>
  <!-- Highlighted, e.g., italicized and otherwise called out terms -->
  <field name="terms_highlighted" type="string" indexed="true" uninvertible="true" stored="false" multiValued="true" docValues="false"/> 
  <field name="dialogs_spkr"  type="string" indexed="true" stored="false" multiValued="true"/>
  <field name="panels_spkr"  type="string" indexed="true" stored="false" multiValued="true"/>
  <field name="poems_src"  type="string" indexed="true" stored="false" multiValued="true"/>


  <!-- set default op to AND NO LONGER SUPPORTED.  Do this with parameter q.op -->
  <!--<solrQueryParser defaultOperator="AND"/>-->

  <!-- Uncomment the dynamicField definition to catch any other fields
   that may have been declared in the DIH configuration.
   This allows to speed up prototyping.
  -->
  <!-- <dynamicField name="*" type="string" indexed="true" stored="true" multiValued="true"/> -->

  <!--For subdocuments (nested documents), this is required-->
  <field name="_nest_path_" type="_nest_path_" />
  <field name="_nest_parent_" type="string" indexed="true" stored="true"/>
  <fieldType name="_nest_path_" class="solr.NestPathField" /> 

  <!--top level para, for nesting tests and comparisons.  
                      TODO: Might want to later include attribs like lang!
                      This is a single field with multiple paragraphs in a list structure -->
  <field name="art_para" type="text_general" indexed="true" stored="false" multiValued="true"/>
  <field name="art_level" type="pint" indexed="true" stored="false" docValues="true"/>
  <!-- include all languages in any element attribute (moved here because it also applies to paras) -->
  <field name="lang" type="string" indexed="true" stored="true" multiValued="true" docValues="true"/>
  
  <!--subdocument fields -->
  <field name="para" type="text_general" indexed="true" stored="true" multiValued="false"/>
  <field name="para_syn" type="text_general_syn" indexed="true" stored="false" multiValued="false"/>
  <!--Store document id for possible non-Solr syntax back references to document-->
  <field name="para_art_id" type="string" indexed="true" stored="true" multiValued="false"/>

  <!--Added 2020-07-06 to allow GW/SE mapping-->
  <field name="para_lgrid" type="string" indexed="true" stored="true" docValues="true"/>
  <!--<field name="para_lgrx" type="string" indexed="false" stored="true" multiValued="true"/>-->
  <field name="para_lgrx" type="string" indexed="true" stored="true" multiValued="true" docValues="true"/>
  <field name="parent_tag" type="string" indexed="true" stored="true"/>
  <copyField source="para" dest="para_syn"/>
  
  <!--<field name="level" type="pint" indexed="true" stored="false" docValues="true"/>-->

  <!-- The String case insensitive field.
       From: http://pietervogelaar.nl/solr-3-5-search-case-insensitive-on-a-string-field-for-exact-match

      With this field type case is preserved for stored values, but a case insensitive field will
      be provided to search on. Caveat: case insensitive wildcard search cannot be done since
      wild card phrases bypass the query analyzer and will not be lowercased before matching
      against the index. This means that the characters in wildcard phrases must be lowercase in
      order to match.       
  -->
    <fieldType name="string_ci" class="solr.TextField" sortMissingLast="true" omitNorms="true">
    <analyzer type="query">
        <tokenizer class="solr.KeywordTokenizerFactory"/>
        <filter class="solr.LowerCaseFilterFactory"/>
    </analyzer>
    <!--Try to add this same config as an index analyzer, solve issues with conjoined words 
        in facet data for glossary_group_terms and glossary_terms 2021-01-28-->
    <analyzer type="index">
        <tokenizer class="solr.KeywordTokenizerFactory"/>
        <filter class="solr.LowerCaseFilterFactory"/>
    </analyzer>    
  </fieldType>  

  <!-- A basic text field that has reasonable, generic
   cross-language defaults: it tokenizes with StandardTokenizer,
   and down cases. It does not deal with stopwords or other issues.
   See other examples for alternative definitions.
  -->
  <fieldType name="text_simple" class="solr.TextField" positionIncrementGap="100">
    <analyzer>
      <!-- nrs added HTMLStripCharFilterFactory -->
      <charFilter class="solr.HTMLStripCharFilterFactory"/>
      <tokenizer class="solr.StandardTokenizerFactory"/>
      <filter class="solr.LowerCaseFilterFactory"/>
    </analyzer>
  </fieldType>

  <!-- A general text field that has reasonable, generic
       cross-language defaults: it tokenizes with StandardTokenizer,
       removes stop words from case-insensitive "stopwords.txt"
       (empty by default), and down cases.  At query time only, it
       also applies synonyms.
  -->
  <fieldType name="text_general" class="solr.TextField" positionIncrementGap="100" storeOffsetsWithPositions="false" multiValued="true">
    <analyzer type="index">
      <!-- nrs added HTMLStripCharFilterFactory -->
      <charFilter class="solr.HTMLStripCharFilterFactory"/>
      <tokenizer class="solr.StandardTokenizerFactory"/>
      <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
      <filter class="solr.LowerCaseFilterFactory"/>
    </analyzer>
    <analyzer type="query">
      <tokenizer class="solr.StandardTokenizerFactory"/>
      <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
      <filter class="solr.LowerCaseFilterFactory"/>
    </analyzer>
  </fieldType>

  <fieldType name="text_general_syn" class="solr.TextField" positionIncrementGap="100" storeOffsetsWithPositions="false" multiValued="true">
  <analyzer type="index">
    <!-- nrs added HTMLStripCharFilterFactory -->
    <charFilter class="solr.HTMLStripCharFilterFactory"/>
    <tokenizer class="solr.StandardTokenizerFactory"/>
    <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
    <filter class="solr.LowerCaseFilterFactory"/>
  </analyzer>
  <analyzer type="query">
    <tokenizer class="solr.StandardTokenizerFactory"/>
    <filter class="solr.StopFilterFactory" ignoreCase="true" words="stopwords.txt" />
    <filter class="solr.SynonymGraphFilterFactory" synonyms="synonyms.txt" ignoreCase="true" expand="true"/>
    <filter class="solr.LowerCaseFilterFactory"/>
  </analyzer>
</fieldType>

<!-- The StrField type is not analyzed, but indexed/stored verbatim. -->
<fieldType name="string" class="solr.StrField" sortMissingLast="true" docValues="true" />
<fieldType name="strings" class="solr.StrField" sortMissingLast="true" multiValued="true" docValues="true" />

<!-- boolean type: "true" or "false" -->
<fieldType name="boolean" class="solr.BoolField" sortMissingLast="true"/>
<fieldType name="booleans" class="solr.BoolField" sortMissingLast="true" multiValued="true"/>

<fieldType name="pint" class="solr.IntPointField" docValues="true"/>
  <fieldType name="pfloat" class="solr.FloatPointField" docValues="true"/>
  <fieldType name="plong" class="solr.LongPointField" docValues="true"/>
  <fieldType name="pdouble" class="solr.DoublePointField" docValues="true"/>

  <fieldType name="pints" class="solr.IntPointField" docValues="true" multiValued="true"/>
  <fieldType name="pfloats" class="solr.FloatPointField" docValues="true" multiValued="true"/>
  <fieldType name="plongs" class="solr.LongPointField" docValues="true" multiValued="true"/>
  <fieldType name="pdoubles" class="solr.DoublePointField" docValues="true" multiValued="true"/>
  <fieldType name="random" class="solr.RandomSortField" indexed="true"/>

  <!-- The format for this date field is of the form 1995-12-31T23:59:59Z, and
       is a more restricted form of the canonical representation of dateTime
       http://www.w3.org/TR/xmlschema-2/#dateTime
       The trailing "Z" designates UTC time and is mandatory.
       Optional fractional seconds are allowed: 1995-12-31T23:59:59.999Z
       All other components are mandatory.

       Expressions can also be used to denote calculations that should be
       performed relative to "NOW" to determine the value, ie...

             NOW/HOUR
                ... Round to the start of the current hour
             NOW-1DAY
                ... Exactly 1 day prior to now
             NOW/DAY+6MONTHS+3DAYS
                ... 6 months and 3 days in the future from the start of
                    the current day

    -->
  <!-- KD-tree versions of date fields -->
  <fieldType name="pdate" class="solr.DatePointField" docValues="true"/>
  <fieldType name="pdates" class="solr.DatePointField" docValues="true" multiValued="true"/>

  <!--Binary data type. The data should be sent/retrieved in as Base64 encoded Strings -->
  <fieldType name="binary" class="solr.BinaryField"/>

  <!-- since fields of this type are by default not stored or indexed,
     any data added to them will be ignored outright.  -->
  <fieldType name="ignored" stored="false" indexed="false" multiValued="true" class="solr.StrField"/>

  <!--text field which allows partial searches-->
  <fieldType name="text_ngrm" class="solr.TextField" positionIncrementGap="100">
    <analyzer type="index">
       <tokenizer class="solr.WhitespaceTokenizerFactory"/>
        <filter class="solr.NGramFilterFactory" minGramSize="1" maxGramSize="50"/>
        <filter class="solr.LowerCaseFilterFactory"/>
    </analyzer>
     <analyzer type="query">
       <tokenizer class="solr.WhitespaceTokenizerFactory"/>
       <filter class="solr.LowerCaseFilterFactory"/>
     </analyzer>
   </fieldType>

  <!--This sorts correctly.  Must be indexed though   -->
  <fieldtype name="string_lc" class="solr.TextField" sortMissingLast="true" omitNorms="true">
    <analyzer>
      <charFilter class="solr.HTMLStripCharFilterFactory"/>
      <filter class="solr.LowerCaseFilterFactory"/>
      <tokenizer class="solr.KeywordTokenizerFactory"/>
    </analyzer>
  </fieldtype>

</schema>