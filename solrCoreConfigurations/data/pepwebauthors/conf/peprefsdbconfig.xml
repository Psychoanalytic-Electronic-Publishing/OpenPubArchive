<!-- Sample Data Input handler, PDF and PEP XML.  Mostly string fields imported from the
      XML, at the CDATA level since otherwise it doesn't seem to get in.

      2019-05-09 NRS       Version 0.1

-->

<dataConfig>
  <dataSource name="PEPXMLRefsImporter" type="FileDataSource"/>
  <document>
    <!-- this outer processor generates a list of files satisfying the conditions specified in the attributes -->
      <!-- Alternate entity definitions for testing convenience -->
      <!-- <entity name="f" processor="FileListEntityProcessor" fileName=".*(bEXP_ARCH1).*"
        recursive="true" baseDir="${solr.install.dir}/pepsampledocs"
        rootEntity="false"> -->

      <!-- Alternate entity definition with full path to real source for convenience -->
      <!-- <entity name="f" processor="FileListEntityProcessor" fileName=".*(bEXP_ARCH1)\.xml"
      recursive="true" baseDir="X:\_PEPA1\_PEPa1v\_PEPArchive\CPS\"
      rootEntity="false"> -->
      <!-- > -->
      <!-- This entity points to data within the core path -->
      <entity name="f" processor="FileListEntityProcessor" fileName=".*(bEXP_ARCH1).*(xml|XML)"
         recursive="true" baseDir="${solr.install.dir}/server/solr/pepwebproto/sampledata"
         rootEntity="false">

      <!-- this processor extracts content using Xpath from each file found -->

      <!-- NOTE: column is the predefined entity attribute and name is the Solr field! -->
      <field column="file" name="myfileName" />
      <field column="fileDir" name="myfileDir" />
      <field column="fileLastModified" name="myfileLastModified" />
      <field column="fileAbsolutePath" name="myfileAbsolutePath" />
      <field column="fileSize" name="myfileSize" />

      <entity name="nested" processor="XPathEntityProcessor" forEach="/pepkbd3//be" url="${f.fileAbsolutePath}" >
          <!-- Common fields -->
         <field column="id" xpath="concat(/pepkbd3/artinfo/@id, //be/@id)"/>
         <field column="authors" xpath="/pepkbd3/artinfo/artauth/aut/@authindexid"/>
         <field column="title" xpath="/pepkbd3/artinfo/arttitle" meta="true"/>
         <field column="text"  xpath="/pepkbd3/node()"/>

          <!-- Metadata fields -->
          <!-- <field column="author_name_first" xpath="/pepkbd3/artinfo/artauth/aut/nfirst"/> -->
          <!-- Article front matter fields -->
          <field column="artid" xpath="/pepkbd3/artinfo/@id"/>
          <field column="artjournal" xpath="/pepkbd3/artinfo/@j"/>
          <field column="arttitle" xpath="/pepkbd3/artinfo/arttitle"/>
          <field column="artvol" xpath="/pepkbd3/artinfo/artvol"/>
          <field column="artyear" xpath="/pepkbd3/artinfo/artyear"/>

          <!-- Doing this since copyfield doesn't seem to work for this field! -->
          <!-- biblio section fields -->
          <field column="bib_ref_rx" xpath="/pepkbd3//be/@rx"/>
          <field column="bib_ref_id" xpath="/pepkbd3//be/@id"/>
          <field column="bib_articletitle" xpath="/pepkbd3//t"/>
          <field column="bib_author_names" xpath="/pepkbd3//a"/>
          <field column="bib_booktitle" xpath="/pepkbd3//bst"/>
          <field column="bib_journaltitle" xpath="/pepkbd3//be/j"/>
          <field column="bib_yearofpublication" xpath="/pepkbd3//be/y"/>
          <field column="bib_yearofbookpublication" xpath="/pepkbd3//bpd"/>
          <field column="bib_volume" xpath="/pepkbd3//be/v"/>
          <field column="bib_publishers" xpath="/pepkbd3//bp"/>
          <field column="bib_refentry" xpath="/pepkbd3//be/node()"/>
          <field column="bib_includeentry" xpath="/pepkbd3//binc"/>


      </entity>
    </entity>
  </document>
</dataConfig>
