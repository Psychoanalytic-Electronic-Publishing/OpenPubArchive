function msieversion(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),a=!1;if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)));var r=e.indexOf("Trident/");if(r>0){var s=e.indexOf("rv:");return parseInt(e.substring(s+3,e.indexOf(".",s)),10)}var o=e.indexOf("Edge/");return o>0?parseInt(e.substring(o+5,e.indexOf(".",o)),10):a}function threePlayScript(e,t){var s=document.createElement("<div></div>"),o=document.createElement('<div id="transcript_p10627_721874"></div>');if(s.appendChild(o),"undefined"==typeof p3_instances&&(p3_instances={}),void 0===e)var e="0mu1eiktak";if(p3_instances.wistia_embed_id||(p3_instances.wistia_embed_id={file_id:e,player_type:"wistia_iframe",api_version:"simple",project_id:"11714",platform_integration:!0}),p3_instances.wistia_embed_id.transcript={target:"transcript_p10627_721874",skin:"ice",template:"default",height:"360",width:"350"},"undefined"==typeof p3_is_loading||!p3_is_loading){p3_is_loading=!0;var n=document.createElement('<div id="p3-js-main-root"></div>'),i=document.createElement("script");i.async=!0,i.src="//p3.3playmedia.com/p3.js",n.appendChild(i)}return s.appendChild(n),$(t).replaceWith(s),s}function ajaxCallErrorMessages(e,t,a){var r,s=e.status;if(400===s)r=t===!1?{messageID:"ajaxAuthError",description:"Authentication error or timeout.  Please try to load the article again"}:{messageID:"ajaxAuthErrorLogin",description:"Authentication error or timeout.  Please login again"};else if(404===s)r={messageID:"ajaxError404",description:"Requested page not found."};else if(500===s)r={messageID:"ajaxError500",description:"Internal Server Error [500]."};else if("parsererror"===a)r={messageID:"ajaxParserError",description:"Server data parse failed"};else if("timeout"===a)r={messageID:"ajaxTimeout",description:"Server Timeout error."};else if("abort"===a)r={messageID:"ajaxAbort",description:"Server request aborted."};else{var o;o=""===e.responseType?"Uncaught Error: "+e.responseText:"Uncaught Error: "+s,console.error(o),r={messageID:"ajaxUncaught",description:o}}return r}function fixedEncodeURIComponent(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16)})}function setGlossaryStyle(e){var t=e,a=!0;return e===!0?($("body").addClass("glossaryHighlight"),setCookie("showGlossaryTerms",!0,1)):e===!1?($("body").removeClass("glossaryHighlight"),setCookie("showGlossaryTerms",!1,1)):(t=getCookie("showGlossaryTerms"),"true"===t?t=setGlossaryStyle(!0):"false"===t?t=setGlossaryStyle(!1):(setGlossaryStyle(a),t=a)),t}function setJustifyStyle(e){var t=e,a=!0;return e===!0?($("body").addClass("justify"),setCookie("justifyText",!0,1)):e===!1?($("body").removeClass("justify"),setCookie("justifyText",!1,1)):(t=getCookie("justifyText"),t=setJustifyStyle("true"===t?!0:"false"===t?!1:a)),t}function checkLoginStatus(e,t,a){var r=e+"/v1/License/Status/Login",s=new XMLHttpRequest;s.open("GET",r,!0),s.withCredentials=!0,s.responseType="json";var o=null;return"undefined"==typeof t&&(t=""),"undefined"==typeof a&&(a=null),""!==t&&"IPLogin"!==t&&s.setRequestHeader("Authorization","Bearer "+t),s.onload=function(e,t){if(200!==s.status)o=400===s.status?"Authentication error or timeout.  Please try again":404===s.status?"Requested page not found. [404]":500===s.status?"Internal Server Error [500].":"parsererror"===t?"Requested JSON parse failed.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":s.response.error+" "+s.response.error_description,null!==a&&a(s.status,o);else{var n,r=msieversion();n=r===!1?s.response:r>=12?s.response:JSON.parse(s.response);try{loggedInToServer=n.licenseInfo.responseInfo.loggedIn}catch(i){alert("Error: "+i)}o=loggedInToServer?"PEPWebAPI: You are currently logged in.":"PEPWebAPI: You are not logged in",null!==a&&a(loggedInToServer,o)}},s.send(),loggedInToServer}function loginToServer(e,t,a,r,s){var o="";s===!0&&(o="&ka=true");var n=e+"/v1/Token?grant_type=password&username="+t+"&password="+a+o;("undefined"==typeof r||null===r)&&(r=null),$.ajaxSetup({xhrFields:{withCredentials:!0}}),$.ajax({dataType:"json",url:n,success:function(e){setCookie("PHPSESSID",e.access_token,200),loggedInToServer=!0,null===r?console.log("Logged in!"):r(!0,"Logged in!",200,e.access_token)},error:function(e,t){var a="";a=0===e.status?"Not connected.\n Verify Network.":404==e.status?"Requested page not found. [404]":500==e.status?"Internal Server Error [500].":"parsererror"===t?"Requested JSON parse failed.":"timeout"===t?"Time out error.":"abort"===t?"Ajax request aborted.":"Uncaught Error.\n"+e.responseText,loggedInToServer=!1,null===r?(alert("Login failed.  Please check your username and password and try again."),console.log(a)):r(!1,JSON.parse(e.responseText),e.status,null)}})}function logoutFromServer(e,t,a){var r="";a===!0&&(r="?ka=true");var s=e+"/v1/Logout"+r;"undefined"==typeof t&&(t=null),$.ajax({dataType:"json",url:s,success:function(e){loggedInToServer=!1,null===t?alert("Logged Out"):t(!1,"Logged out!")},error:function(e,a){var r;r="Error.\n"+e.responseText,loggedInToServer=!1,null===t?alert("Logout failed.  MSG:"+r):t(!1,r)}})}function getDocumentData(e,t,a){var r=new XMLHttpRequest,s=baseURL+"/v1/Documents/"+e+"/";r.open("GET",s,!0),r.responseType="json",r.withCredentials=!0;var o=null;""!==t&&($("html").addClass("waiting"),"IPLogin"!==t&&r.setRequestHeader("Authorization","Bearer "+t),r.onload=function(e,t){var n=null;if(200!==r.status)o=ajaxCallErrorMessages(r,loggedInToServer,t),$("html").removeClass("waiting"),"undefined"!=typeof a&&a(null,r.status,o,null);else{var i=msieversion();n=i===!1?r.response:i>=12?r.response:JSON.parse(r.response);var l=n.documents.responseSet,c=l.document;c=c.replace(/href=\"document\.php\?id\=([^\"]+)\"/g,"href=#/Document/$1"),c=c.replace(/href=\"search\.php\?([^\"]+)\"/g,"href=#/Search/?$1"),c=c.replace(/href=\"toc\.php\?journal=([^\&]+).*volume=([^\#]+)\#p?([0-9]+)\"/g,"href=#/ArticleList/?journal=$1&amp;vol=$2&amp;page=$3"),c=c.replace(/href=\"[ ]?\/v1\/Documents\/Downloads\/PDF\/([^\"]+)\"/g,"href=''"),c=c.replace(/href=\"#(p?)([^\"]+)\"/g,"href='#/Document/"+l.documentID+"#$1$2'"),l.document=c,o=l.accessLimited===!0?{messageID:"limited",description:l.accessLimitedDescription}:-1!==s.search("/Abstract")?{messageID:"abstract",description:"This is the abstract or summary.  Use the buttons below to read or download the full document."}:-1!==s.search("/Document")?{messageID:"fullDocument",description:"This is the full document."}:{messageID:"unknownError",description:"An unknown error retrieving the document has occurred!"},$("html").removeClass("waiting"),"undefined"!=typeof a&&a(n.documents.responseInfo,r.status,o,l)}},r.send())}function getAbstractWithCred(e,t,a){var r=new XMLHttpRequest,s=baseURL+"/v1/Documents/Abstracts/"+e+"/";r.open("GET",s,!0),r.responseType="json",r.withCredentials=!0;var o=null;""!==t&&"IPLogin"!==t?r.setRequestHeader("Authorization","Bearer "+t):loggedInToServer&&console.log("Logged into server but accessToken not supplied in API call getAbstract. The value of accessLimited will not be accurate."),r.onload=function(t,s){var n=null;if(200!==r.status)o=ajaxCallErrorMessages(r,loggedInToServer,s),"undefined"!=typeof a&&(i="There was an error retrieving the abstract for document: "+e,null!==a&&a(i,e,null));else{var i=null,l=msieversion();if(n=l===!1?r.response:l>=12?r.response:JSON.parse(r.response),1===n.documents.responseInfo.count){var c=n.documents.responseSet[0]["abstract"];c=c.replace(/<script.*<\/script>/g,""),c=c.replace(/<\/?span.*?>/g,""),c=c.replace(/\[(SE|GW)[A-Z][0-9]{1,4}[a-z][0-9]{1,4}\]/g,""),c=c.replace(/href=\"document\.php\?id\=([^\"]+)\"/g,"href=#/Document/$1"),c=c.replace(/href=\"toc\.php\?journal=([^\&]+).*volume=([^\#]+)\#p?([0-9]+)\"/g,"class='disabled'"),c=c.replace(/src=\"images\/.*\"/g,'src=""'),n.documents.responseSet[0]["abstract"]=c,void 0!==n.documents.responseSet[0].accessLimitedDescription&&(i=n.documents.responseSet[0].accessLimitedDescription),n.documents.responseSet[0].accessLimited?n.documents.responseSet[0].accessPermitted=!1:n.documents.responseSet[0].accessPermitted=!0,null!==a?a(o,e,n.documents.responseSet[0]):alert("There was an error retrieving the abstract for document: "+e)}}$("html").removeClass("waiting")},$("html").addClass("waiting"),r.send()}function getAbstract(e,t){"undefined"==typeof t&&(t=null),$("html").addClass("waiting");var a=baseURL+"/v1/Documents/Abstracts/"+e+"/";console.log("apiCall:"+a),$.getJSON(a,function(a,r){var s=null;if(1===a.documents.responseInfo.count){console.log(a.documents.responseSet);var o=a.documents.responseSet[0]["abstract"];o=o.replace(/<script.*<\/script>/g,""),o=o.replace(/<\/?span.*?>/g,""),o=o.replace(/\[(SE|GW)[A-Z][0-9]{1,4}[a-z][0-9]{1,4}\]/g,""),o=o.replace(/href=\"document\.php\?id\=([^\"]+)\"/g,"href=#/Document/$1"),o=o.replace(/href=\"toc\.php\?journal=([^\&]+).*volume=([^\#]+)\#p?([0-9]+)\"/g,"class='disabled'"),o=o.replace(/src=\"images\/.*\"/g,'src=""'),a.documents.responseSet[0]["abstract"]=o,void 0!==a.documents.responseSet[0].accessLimitedDescription&&(s=a.documents.responseSet[0].accessLimitedDescription),a.documents.responseSet[0].accessLimited?a.documents.responseSet[0].accessPermitted=!1:a.documents.responseSet[0].accessPermitted=!0,null!==t?t(s,e,a.documents.responseSet[0]):(s="There was an error retrieving the abstract for document: "+e,null!==t&&t(s,e,null))}$("html").removeClass("waiting")},"json")}function getDocumentDownload(e,t,a,r,s){var o=new XMLHttpRequest,n=t;o.open("GET",e,!0),o.responseType="arraybuffer",o.withCredentials=!0,"undefined"==typeof s&&(s=null),""!==r&&("IPLogin"!==r&&o.setRequestHeader("Authorization","Bearer "+r),o.onload=function(e,r){var l,c,i="",u=!!window.MSInputMethodContext&&!!document.documentMode,d=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream;if(200!==o.status)c=ajaxCallErrorMessages(o,loggedInToServer,r),null!==s&&s(null,o.status,c,t,null);else if(0===o.response.byteLength)i="Download unsuccessful.  Current content is not available on PEP-Web but may be available to journal subscribers on the publisher's website.  If not current content, your subscription may not include downloads of this document.",c={messageID:"DownloadFailed",description:i},null!==s&&s(0,415,c,t,null);else{var h;if(h="pdf"===a?new Blob([o.response],{type:"application/pdf"}):new Blob([o.response],{type:"application/epub+zip"}),u){window.navigator.msSaveBlob(h,n+"."+a);var f=document.createElement("a");f.href=window.URL.createObjectURL(h),f.download=n+"."+a,l=f.download,i="Download successful.  Document saved to "+f.download+".",c={messageID:"downloadSuccess",description:i}}else if(d){l="browser",i="Download successful.  Document opened.",c={messageID:"downloadSuccess",description:i};var p=new FileReader;p.onload=function(e){window.location.href=p.result},p.readAsDataURL(h)}else{var f=document.createElement("a");f.href=window.URL.createObjectURL(h),f.download=n+"."+a,l=f.download,i="Download successful.  Document saved to "+f.download+".",c={messageID:"downloadSuccess",description:i},document.body.appendChild(f),f.target="_blank",f.click()}null!==s&&s(h.length,200,c,t,l)}},o.send())}function getListOfWhatsNew(e){$("html").addClass("waiting");var a,t=baseURL+"/v1/Database/WhatsNew/";$.getJSON(t,function(t,r){e([]);for(var s=0,o=t.whatsNew.responseSet.length;o>s;s++)a=t.whatsNew.responseSet[s],e.push({volumeURL:""+a.PEPCode+"/"+a.volume,PEPCode:a.PEPCode.toUpperCase(),srcTitleSeries:decodeHtml(a.srcTitle),displayTitle:decodeHtml(a.displayTitle),vol:a.volume,issueInfo:a.issue,updated:a.updated.substring(0,10)});$("html").removeClass("waiting")},"json")}function getListOfMost(e,t,a,r,s){$("html").addClass("waiting");var o=["ZBK","IPL","NLP","SE","GW"];"undefined"==typeof a&&(a=null),"undefined"==typeof r&&(r=null),("undefined"==typeof s||null===s)&&(s=!0),r?a("...Waiting for Server..."):null!==a&&a(""),$.getJSON(e,function(e,s){t([]);for(var n,i,l,c,u=0,d=e.documentList.responseSet.length;d>u;u++)n=e.documentList.responseSet[u],c=n.PEPCode.toUpperCase(),l=n.documentID.split("."),i=l[1],i.replace(/^0+/,""),-1==o.indexOf(c)&&"VS"!=c.slice(-2)&&t.push({documentID:n.documentID,documentRef:decodeHtml(n.documentRef),vol:i,PEPCode:n.PEPCode.toUpperCase()});r&&a("")},"json").success(function(){$("html").removeClass("waiting")}).error(function(e,t,a){$("html").removeClass("waiting")})}function getListOfSources(e,t,a){var o,n,r=["ZBK"],s=["IPL","NLP"];$.getJSON(e,function(e,i){for(var l=0,c=e.sourceInfo.responseSet.length;c>l;l++){o=e.sourceInfo.responseSet[l];var u,d="",h="",f=null;o.displayTitle=decodeHtml(o.displayTitle);var p=o.PEPCode.toUpperCase();void 0!==o.documentID?(n=o.documentID.split("."),d=n[0].toUpperCase()+"."+n[1],o.PEPCode=n[0].toUpperCase(),p=o.PEPCode,f=n[1]):d=p,u=-1!=r.indexOf(p)?"Book":-1!=s.indexOf(p)?"BookSerial":"Serial","SE"===o.PEPCode&&(h='The Standard Edition of the Complete Psychological Works of Sigmund Freud, Vols 1-24                                 <ul>                                    <li><a href="#Books/BookContents/cSE/v1">Volume 1</a></li>                                    <li><a href="#Books/BookContents/cSE/v2">Volume 2</a></li>                                 </ul>                             ',o.displayTitle=h),"GW"===o.PEPCode&&(h='Gesammelte Werke: Chronologisch Geordnet, Vols 1-18<ul>                                 <li data-bind="attr: {id: documentID, sourceType: sourceType},                                            click: $root.goToTOCDirect">                                     <a href="#Books/BookContents/cGW.v1">Volume 1</a></li>                                 <li><a href="#Books.BookContents.cGW.v2">Volume 2</a></li></ul>',o.displayTitle=h),t.push({sourceType:u,title:o.PEPCode+": "+o.displayTitle,PEPCode:o.PEPCode,volume:f,documentID:d,issn:o.issn,isbn:o.ISBN-10})}"undefined"!=typeof a&&a(t,e.sourceInfo.responseInfo)},"json")}function getSearchAnalysis(e,t,a){var r;$.getJSON(e,function(e,s){if(t([]),e.documentList.responseInfo.count>0)for(var o=0,n=e.documentList.responseSet.length;n>o;o++)r=e.documentList.responseSet[o],t.push({term:r.term,termCount:r.termCount,combined:r.combined,combinedCount:r.combinedCount});"undefined"!=typeof a&&a(e.documentList.responseInfo)},"json")}function getListOfVols(e,t){var a;$.getJSON(e,function(e,r){t([]);for(var s=0,o=e.volumeList.responseSet.length;o>s;s++)a=e.volumeList.responseSet[s],t.push({PEPCode:a.PEPCode,vol:a.vol,year:a.year})},"json")}function getListOfArticles(e,t,a){var r,s;$("html").addClass("waiting"),$.getJSON(e,function(e,o){t([]);for(var n=!1,i=0,l=e.documentList.responseSet.length;l>i;i++)r=e.documentList.responseSet[i],r.documentRef=decodeHtml(r.documentRef),s=r.kwic,""!==s&&(n=!0,". . ."===s.substr(s.length-5)&&(s=s.substr(0,s.length-6)),s=s.replace(/\. \. \./g,"</li><li>")),t.push({documentRef:r.documentRef,documentID:r.documentID,vol:r.vol,searchRank:r.rank,kwic:s,PEPCode:r.PEPCode.toUpperCase()});$("html").removeClass("waiting"),"undefined"!=typeof a&&(e.documentList.responseInfo.hasKWIC=n,a(e.documentList.responseInfo))},"json")}function getListOfcurrAuthorIndexData(e,t){$("html").addClass("waiting"),$.getJSON(e,function(e,a){for(var r,s=0,o=e.authorIndex.responseSet.length;o>s;s++)r=e.authorIndex.responseSet[s],t.push({authorID:r.authorID,publicationURL:r.publicationsURL});$("html").removeClass("waiting")},"json")}function getListOfcurrAuthorPublications(e,t){$("html").addClass("waiting"),$.getJSON(e,function(e,a){var r;t([]);for(var s=0,o=e.authorPubList.responseSet.length;o>s;s++)r=e.authorPubList.responseSet[s],r.documentRef=decodeHtml(r.documentRef),r.authorID=decodeHtml(r.authorID),t.push({authorID:r.authorID,documentID:r.documentID,documentRef:r.documentRef,documentURL:r.documentURL});$("html").removeClass("waiting")},"json")}function isABook(e){var t=["ZBK","IPL","NLP"];return-1!==t.indexOf(e)?!0:!1}function decode(e){return e.replace(/&#(\d+);/g,function(e,t){return String.fromCharCode(t)})}function decodeHtml(e){var t=document.createElement("textarea");return t.innerHTML=e,t.value}function setCookie(e,t,a,r){var s=new Date;s.setTime(s.getTime()+24*a*60*60*1e3);var o="expires="+s.toUTCString();"undefined"==typeof r?document.cookie=e+"="+t+";"+o:document.cookie=e+"="+t+";"+o+"; path=/; domain="+r}function getCookie(e,t){var a=e+"=",r=decodeURIComponent(document.cookie),s=r.split(";");("undefined"==typeof t||null===t)&&(t="");for(var o=0;o<s.length;o++){for(var n=s[o];" "==n.charAt(0);)n=n.substring(1);if(0===n.indexOf(a))return n.substring(a.length,n.length)}return t}function deleteCookie(e){setCookie(e,"",-1)}function make_base_auth(e,t){var a=e+":"+t,r=btoa(a);return"Basic "+r}function setup(e){("undefined"==typeof e||null===e)&&(e="1.5"),fSize=getCookie("fontSize",e),document.body.style.fontSize=fSize+"em"}function setFontSize(e){("undefined"==typeof e||null===e)&&(e="1.5"),fSize=e,document.body.style.fontSize=e+"em",setCookie("fontSize",e,100)}function enlargeFont(){fSize+=.1,document.body.style.fontSize=fSize+"em"}function reduceFont(){fSize-=.1,document.body.style.fontSize=fSize+"em"}function popupReferenceBox(e){void 0===typeof e?alert("Can't display reference because it's not loaded."):($("#refModal.modal-body").innerHTML=e,$("#refModal").modal("show"))}var loggedInToServer,baseURL,fSize="1.5",videoPEPCodesSearchSpec="afcvs+or+bpsivs+or+ijpvs+or+ipsavs+or+nypsivs+or+pcvs+or+pepgrantvs+or+peptopauthvs+or+pepvs+or+sfcpvs+or+spivs+or+uclvs",bookPEPCodesSearchSpec="gw+or+ipl+or+nlp+or+se+or+zbk",journalPEPCodeSearchSpec="anijp-el+or+adpsa+or+aim+or+ajp+or+anijp-it+or+anijp-fr+or+aop+or+ajrpp+or+bjp+or+bap+or+bafc+or+bip+or+cjp+or+anijp-chi+or+cps+or+cfp+or+dr+or+fd+or+fa+or+gap+or+imago+or+ifp+or+ijaps+or+ijp+or+ijpopen+or+ijp-es+or+ijpsp+or+irp+or+anijp-de+or+izpa+or+anrp+or+jbp+or+jppf+or+joap+or+aps+or+jcptx+or+jcp+or+jicap+or+jaa+or+apa+or+mpsa+or+np+or+opus+or+psp+or+psu+or+psyche+or+pcs+or+pct+or+pah+or+ijpsppsc+or+pd+or+pi+or+ppersp+or+ppsy+or+pptx+or+paq+or+psar+or+psw+or+psc+or+psabew+or+pdpsy+or+apm+or+revapa+or+rbp+or+rpp-cs+or+rrp+or+rpsa+or+rip+or+spr+or+sgs+or+tvpa+or+anijp-tr+or+zpsap+or+zbpa";String.prototype.format=function(){var e=0,t=arguments;return this.replace(/{}/g,function(){return"undefined"!=typeof t[e]?t[e++]:""})},$(document).ready(function(){setup(),$("body").on("click","[data-docid]",function(e){var t=$(this),a=t.attr("data-docid");showGlossaryModal(a)}),$("body").on("click",".bibtip",function(e){var t=!1,a="",r=$(this),s=r.attr("data-element");s=s.replace(/\./g,"\\.");var o=r.attr("data-content");if(void 0===o){var n=$("#"+s).html();void 0!==n&&(a=decodeHtml(n),t=!0)}else a=decodeHtml(o),t=!0;return t&&(document.getElementById("refContent").innerHTML=a,$("#refModal").modal("show")),a}),$("body").on("click",".ftntip",function(e){var t=$(this),a=t.attr("data-element"),r=$("#"+a).html(),s=decodeHtml(r);return document.getElementById("ftnContent").innerHTML=s,$("#ftnModal").modal("show"),e.stopPropagation(),!1}),$("body").on("click",".notetip",function(e){var t=$(this),a=t.attr("data-element"),r=$("#"+a).html(),s=decodeHtml(r);return document.getElementById("noteContent").innerHTML=s,$("#noteModal").modal("show"),e.stopPropagation(),!1}),$("body").on("click",".authortip",function(e){var t=$(this),a=t.attr("data-content"),r=decodeHtml(a);return document.getElementById("autContent").innerHTML=r,$("#autModal").modal("show"),r}),$("body").on("click",".booktip",function(e){var t=$(this),a=t.attr("data-content"),r=decodeHtml(a);return document.getElementById("moreInfoContent").innerHTML=r,$("#moreInfoModal").modal("show"),r})});